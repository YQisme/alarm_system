<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOLO 人员检测与区域报警系统</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>YOLO 人员检测与区域报警系统</h1>
            <div class="status-bar">
                <span id="connection-status" class="status-indicator">连接中...</span>
                <span id="polygon-status" class="status-indicator">未设置区域</span>
            </div>
        </header>

        <div class="config-panel" id="config-panel">
            <div class="config-header">
                <h2>系统配置</h2>
                <button id="toggle-config-btn" class="btn-toggle">▼</button>
            </div>
            <div class="config-content" id="config-content" style="display: none;">
                <div class="config-section">
                    <label for="model-select">检测模型:</label>
                    <select id="model-select" class="config-input">
                        <option value="">加载中...</option>
                    </select>
                    <button id="apply-model-btn" class="btn btn-primary btn-small">应用</button>
                </div>
                <div class="config-section">
                    <label for="video-url-input">视频URL:</label>
                    <input type="text" id="video-url-input" class="config-input" placeholder="rtsp://...">
                    <button id="apply-video-btn" class="btn btn-primary btn-small">应用</button>
                </div>
                <div class="config-section classes-section">
                    <label>检测类别:</label>
                    <div class="classes-controls">
                        <button id="select-all-classes-btn" class="btn btn-secondary btn-small">全选</button>
                        <button id="deselect-all-classes-btn" class="btn btn-secondary btn-small">全不选</button>
                        <button id="apply-classes-btn" class="btn btn-primary btn-small">应用</button>
                    </div>
                </div>
                <div class="classes-list-container" id="classes-list-container">
                    <div class="classes-list" id="classes-list">
                        <p class="loading-message">加载中...</p>
                    </div>
                </div>
                <div class="config-section display-section">
                    <label>显示设置:</label>
                    <div class="display-controls">
                        <div class="display-item">
                            <label>字体大小:</label>
                            <input type="number" id="font-size-input" class="config-input-small" min="8" max="72" value="16">
                        </div>
                        <div class="display-item">
                            <label>边框粗细:</label>
                            <input type="number" id="box-thickness-input" class="config-input-small" min="1" max="10" value="2">
                        </div>
                        <div class="display-item">
                            <label>边框颜色:</label>
                            <input type="color" id="box-color-input" value="#00ff00">
                            <input type="text" id="box-color-rgb" class="config-input-small" placeholder="RGB: 0,255,0">
                        </div>
                        <div class="display-item">
                            <label>文字颜色:</label>
                            <input type="color" id="text-color-input" value="#000000">
                            <input type="text" id="text-color-rgb" class="config-input-small" placeholder="RGB: 0,0,0">
                        </div>
                        <div class="display-item">
                            <label>显示语言:</label>
                            <button id="toggle-language-btn" class="btn btn-secondary btn-small">切换为英文</button>
                            <span id="language-status" style="margin-left: 10px; color: #666;">当前: 中文</span>
                        </div>
                        <button id="apply-display-btn" class="btn btn-primary btn-small">应用显示设置</button>
                    </div>
                </div>
                <div class="config-section alarm-section">
                    <label>报警设置:</label>
                    <div class="alarm-controls">
                        <div class="alarm-item">
                            <label>防抖时间（秒）:</label>
                            <input type="number" id="debounce-time-input" class="config-input-small" min="0" max="300" step="0.1" value="5.0">
                            <span style="margin-left: 10px; color: #666; font-size: 12px;">同一目标在此时间内只报警一次</span>
                        </div>
                        <div class="alarm-item">
                            <label>检测模式:</label>
                            <select id="detection-mode-select" class="config-input">
                                <option value="center">中心点模式（检测框中心点进入区域）</option>
                                <option value="edge">边框模式（检测框任意点进入区域）</option>
                            </select>
                        </div>
                        <div class="alarm-item">
                            <label>相同ID只报警一次:</label>
                            <input type="checkbox" id="once-per-id-checkbox">
                            <span style="margin-left: 10px; color: #666; font-size: 12px;">启用后，同一ID在整个生命周期内只报警一次</span>
                        </div>
                        <button id="apply-alarm-btn" class="btn btn-primary btn-small">应用报警设置</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="video-panel">
                <div class="video-container">
                    <canvas id="video-canvas"></canvas>
                    <canvas id="draw-canvas"></canvas>
                    <div class="video-stats" id="video-stats">
                        <span id="fps-display">FPS: --</span>
                        <span id="resolution-display">分辨率: --</span>
                    </div>
                    <div class="drawing-hint" id="drawing-hint" style="display: none;">
                        <p>🖱️ 点击画面绘制多边形区域</p>
                        <p>✨ 接近起点时自动吸附，点击闭合</p>
                        <p>⌨️ 按 ESC 取消，双击完成</p>
                    </div>
                </div>
                <div class="video-controls">
                    <button id="draw-polygon-btn" class="btn btn-primary">绘制监控区域</button>
                    <button id="clear-polygon-btn" class="btn btn-secondary">清除区域</button>
                    <button id="save-polygon-btn" class="btn btn-success">保存区域</button>
                </div>
            </div>

            <div class="sidebar">
                <div class="alarm-panel">
                    <h2>报警记录</h2>
                    <div id="alarm-list" class="alarm-list">
                        <p class="empty-message">暂无报警记录</p>
                    </div>
                </div>

                <div class="detection-panel">
                    <h2>检测信息</h2>
                    <div id="detection-info" class="detection-info">
                        <p class="empty-message">等待检测数据...</p>
                    </div>
                </div>

                <div class="log-panel">
                    <h2>系统日志</h2>
                    <div class="log-controls">
                        <button id="clear-logs-btn" class="btn btn-secondary btn-small">清空日志</button>
                        <label style="margin-left: 10px;">
                            <input type="checkbox" id="auto-scroll-logs" checked> 自动滚动
                        </label>
                    </div>
                    <div id="log-container" class="log-container">
                        <p class="empty-message">等待日志数据...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
</body>
</html>

